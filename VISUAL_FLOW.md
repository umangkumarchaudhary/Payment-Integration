# PhonePe AutoPay - Visual Flow Guide

## ğŸ¬ Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 1: Customer Opens Your Website                       â”‚
â”‚  URL: http://localhost:3000                                 â”‚
â”‚                                                             â”‚
â”‚  [Service Package AutoPay Setup]                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Customer Details                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ Customer Name: [John Doe        ]              â”‚   â”‚
â”‚  â”‚  â”œâ”€ Phone Number:  [9999999999      ]              â”‚   â”‚
â”‚  â”‚  â””â”€ UPI ID:        [success@ybl     ]              â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  Package Details                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€ Package Name:  [3-Year Service  ]              â”‚   â”‚
â”‚  â”‚  â”œâ”€ Total Amount:  [36000           ]              â”‚   â”‚
â”‚  â”‚  â”œâ”€ Installments:  [36              ]              â”‚   â”‚
â”‚  â”‚  â”œâ”€ Start Date:    [2025-11-01      ]              â”‚   â”‚
â”‚  â”‚  â””â”€ Monthly:       [â‚¹1,000.00       ] â† Auto-calc  â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚            [ Setup AutoPay ]                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Click!
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 2: Frontend Validation                                â”‚
â”‚                                                             â”‚
â”‚  âœ… All fields filled?                                      â”‚
â”‚  âœ… Phone is 10 digits?                                     â”‚
â”‚  âœ… Total amount > 0?                                       â”‚
â”‚  âœ… Installments > 0?                                       â”‚
â”‚                                                             â”‚
â”‚  â†’ If YES: Continue                                         â”‚
â”‚  â†’ If NO: Show error message                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Valid!
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 3: API Call to Backend                                â”‚
â”‚                                                             â”‚
â”‚  POST /api/phonepe/initiate-autopay-v3                      â”‚
â”‚  {                                                          â”‚
â”‚    customerName: "John Doe",                                â”‚
â”‚    phone: "9999999999",                                     â”‚
â”‚    upiId: "success@ybl",                                    â”‚
â”‚    packageName: "3-Year Service Package",                   â”‚
â”‚    totalAmount: 36000,                                      â”‚
â”‚    installmentAmount: 1000,                                 â”‚
â”‚    totalInstallments: 36                                    â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  Button shows: "Processing..."                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 4: Backend - Get OAuth Token                          â”‚
â”‚                                                             â”‚
â”‚  POST https://api-preprod.phonepe.com/...                   â”‚
â”‚       /v1/oauth/token                                       â”‚
â”‚                                                             â”‚
â”‚  Request:                                                   â”‚
â”‚  {                                                          â”‚
â”‚    client_id: "MASSRETAILUAT_2510171534",                   â”‚
â”‚    client_secret: "ZDYwODQ...",                             â”‚
â”‚    grant_type: "client_credentials"                         â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  Response:                                                  â”‚
â”‚  {                                                          â”‚
â”‚    access_token: "eyJhbGci...",                             â”‚
â”‚    expires_at: 1761126662                                   â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  âœ… Token cached for 1 hour                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 5: Backend - Validate UPI VPA                         â”‚
â”‚                                                             â”‚
â”‚  POST https://api-preprod.phonepe.com/...                   â”‚
â”‚       /v2/validate/upi                                      â”‚
â”‚                                                             â”‚
â”‚  Headers:                                                   â”‚
â”‚  Authorization: O-Bearer eyJhbGci...                        â”‚
â”‚                                                             â”‚
â”‚  Request:                                                   â”‚
â”‚  {                                                          â”‚
â”‚    type: "VPA",                                             â”‚
â”‚    vpa: "success@ybl"                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  Response:                                                  â”‚
â”‚  {                                                          â”‚
â”‚    valid: true,                                             â”‚
â”‚    name: "Dummy User"                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  âœ… VPA is valid, continue                                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 6: Backend - Create Subscription                      â”‚
â”‚                                                             â”‚
â”‚  POST https://api-preprod.phonepe.com/...                   â”‚
â”‚       /subscriptions/v2/setup                               â”‚
â”‚                                                             â”‚
â”‚  Headers:                                                   â”‚
â”‚  Authorization: O-Bearer eyJhbGci...                        â”‚
â”‚  Content-Type: application/json                             â”‚
â”‚                                                             â”‚
â”‚  Request Body (CORRECT STRUCTURE):                          â”‚
â”‚  {                                                          â”‚
â”‚    "merchantOrderId": "MO1761121036037",                    â”‚
â”‚    "amount": 100000,  â† (â‚¹1000 in paise)                    â”‚
â”‚    "expireAt": 1761121636037,                               â”‚
â”‚    "paymentFlow": {                                         â”‚
â”‚      "type": "SUBSCRIPTION_SETUP",                          â”‚
â”‚      "merchantSubscriptionId": "MS_1761121035560",          â”‚
â”‚      "authWorkflowType": "TRANSACTION",                     â”‚
â”‚      "amountType": "FIXED",                                 â”‚
â”‚      "maxAmount": 100000,                                   â”‚
â”‚      "frequency": "MONTHLY",                                â”‚
â”‚      "expireAt": 1787041036037,                             â”‚
â”‚      "paymentMode": {                                       â”‚
â”‚        "type": "UPI_COLLECT",                               â”‚
â”‚        "details": {                                         â”‚
â”‚          "type": "VPA",                                     â”‚
â”‚          "vpa": "success@ybl"                               â”‚
â”‚        }                                                    â”‚
â”‚      }                                                      â”‚
â”‚    },                                                       â”‚
â”‚    "deviceContext": { "deviceOS": "ANDROID" },              â”‚
â”‚    "metaInfo": {                                            â”‚
â”‚      "udf1": "John Doe",                                    â”‚
â”‚      "udf2": "9999999999",                                  â”‚
â”‚      "udf3": "3-Year Service Package"                       â”‚
â”‚    }                                                        â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 7: PhonePe Response                                   â”‚
â”‚                                                             â”‚
â”‚  200 OK                                                     â”‚
â”‚  {                                                          â”‚
â”‚    "orderId": "OMO2510221444328696300240",                  â”‚
â”‚    "state": "PENDING"                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  âœ… SUCCESS! Subscription created                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 8: Backend Response to Frontend                       â”‚
â”‚                                                             â”‚
â”‚  200 OK                                                     â”‚
â”‚  {                                                          â”‚
â”‚    "success": true,                                         â”‚
â”‚    "message": "AutoPay subscription setup initiated",       â”‚
â”‚    "data": {                                                â”‚
â”‚      "orderId": "OMO2510221444328696300240",                â”‚
â”‚      "subscriptionId": "MS_1761121035560",                  â”‚
â”‚      "merchantOrderId": "MO1761121036037",                  â”‚
â”‚      "state": "PENDING",                                    â”‚
â”‚      "nextSteps": "Customer will receive authorization..."  â”‚
â”‚    }                                                        â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 9: Frontend Shows Success                             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âœ… Success! AutoPay subscription setup initiated.  â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Order ID: OMO2510221444328696300240                â”‚    â”‚
â”‚  â”‚ Subscription ID: MS_1761121035560                  â”‚    â”‚
â”‚  â”‚ Status: PENDING                                    â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚ â”‚ ğŸ“± Next Step: Customer will receive         â”‚   â”‚    â”‚
â”‚  â”‚ â”‚    authorization request in their UPI app   â”‚   â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ In Production...
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 10: Customer's UPI App (Production Only)              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“± PhonePe / Google Pay / Paytm                   â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  ğŸ”” New Mandate Request                            â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  Merchant: Your Dealership                         â”‚    â”‚
â”‚  â”‚  Amount: â‚¹1,000 per month                          â”‚    â”‚
â”‚  â”‚  Frequency: Monthly                                â”‚    â”‚
â”‚  â”‚  Duration: 36 months                               â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  [ Authorize ]  [ Reject ]                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Customer clicks Authorize
                            â”‚ Enters UPI PIN
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 11: PhonePe Webhook to Your Server                    â”‚
â”‚                                                             â”‚
â”‚  POST http://localhost:3000/api/phonepe/webhook             â”‚
â”‚                                                             â”‚
â”‚  {                                                          â”‚
â”‚    "event": "SUBSCRIPTION_ACTIVATED",                       â”‚
â”‚    "subscriptionId": "MS_1761121035560",                    â”‚
â”‚    "orderId": "OMO2510221444328696300240",                  â”‚
â”‚    "status": "ACTIVE"                                       â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  â†’ Your webhook handler updates database                    â”‚
â”‚  â†’ Sends confirmation email/SMS to customer                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  STEP 12: Monthly Auto-Debits Begin                         â”‚
â”‚                                                             â”‚
â”‚  Every month on the same date:                              â”‚
â”‚                                                             â”‚
â”‚  Month 1: â‚¹1,000 debited â†’ Webhook notification            â”‚
â”‚  Month 2: â‚¹1,000 debited â†’ Webhook notification            â”‚
â”‚  Month 3: â‚¹1,000 debited â†’ Webhook notification            â”‚
â”‚  ...                                                        â”‚
â”‚  Month 36: â‚¹1,000 debited â†’ Subscription complete          â”‚
â”‚                                                             â”‚
â”‚  Customer doesn't need to do anything!                      â”‚
â”‚  âœ… Automatic monthly payments                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key Files Involved

```
Frontend Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pages/index.js                  â”‚  â† Customer fills form
â”‚       â”‚                          â”‚
â”‚       â”œâ”€ Validates input         â”‚
â”‚       â”œâ”€ Auto-calculates monthly â”‚
â”‚       â””â”€ Calls API on submit     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ POST /api/phonepe/initiate-autopay-v3
          â–¼
Backend Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pages/api/phonepe/initiate-autopay-v3.js       â”‚
â”‚       â”‚                                          â”‚
â”‚       â”œâ”€ Uses PhonePeAutoPayCorrect class       â”‚
â”‚       â”œâ”€ Validates phone, UPI                   â”‚
â”‚       â””â”€ Returns success/error                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ import PhonePeAutoPayCorrect
          â–¼
Helper Class:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  lib/phonepe-autopay-correct.js                 â”‚
â”‚       â”‚                                          â”‚
â”‚       â”œâ”€ generateAuthToken()                    â”‚
â”‚       â”œâ”€ validateUpiVpa()                       â”‚
â”‚       â”œâ”€ setupSubscription()   â† CORRECT        â”‚
â”‚       â””â”€ getOrderStatus()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Makes API calls to PhonePe
          â–¼
PhonePe APIs:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. /v1/oauth/token                              â”‚
â”‚  2. /v2/validate/upi                             â”‚
â”‚  3. /subscriptions/v2/setup      â† MAIN API      â”‚
â”‚  4. /subscriptions/v2/order/{id}/status          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Transformation

```
User Input â†’ Frontend â†’ Backend â†’ PhonePe
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Total Amount: 36000
Installments: 36
              â†“
Monthly: 1000 (calculated)
              â†“
amount: 100000 (converted to paise)
              â†“
paymentFlow.maxAmount: 100000
```

---

## âœ… Success Response Chain

```
PhonePe â†’ Backend â†’ Frontend â†’ User
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{                              {
  orderId: "OMO...",            success: true,           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  state: "PENDING"    â†’         data: {          â†’       â”‚ âœ… Success!  â”‚
}                                 orderId: "..."         â”‚ Order ID: ..â”‚
                                  state: "PENDING"       â”‚ Status: ...  â”‚
                               }                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             }
```

---

## ğŸ¨ UI States

```
Initial State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ Setup AutoPay ]     â”‚  â† Blue button, enabled
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Loading State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ Processing... ]     â”‚  â† Gray button, disabled
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Success State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Success! AutoPay setup...      â”‚  â† Green box
â”‚  Order ID: OMO...                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Error State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Error: Invalid phone number... â”‚  â† Red box
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This is the complete flow of your PhonePe AutoPay integration!** ğŸ‰
